<container>
	<div ng-controller="projectsListCtrl"
		     filtered-list="{method: 'home/projects/getProjects'}"
		     initial-sorters="{ CreationTime: 'desc' }">
		<twocolumn-side>
			<button type="button" class="btn btn-success" ng-click="refreshList()"
			        ng-disabled="!applyEnabled" style="float:right;">Apply</button>

			<tabset>
				<tab heading="Simple">
					<form>
						<fieldset>
							<label>Наименование</label>
							<input lookup="home/projects/lookupProjectNames" ng-model="filter.simple.Name" filter-node="{path: 'Name', op:'='}" class="span12" multiple />
							<label>Статус</label>
							<input lookup="home/dictionary/lookupProjectStatuses" ng-model="filter.simple.Status" filter-node="{path: 'Status', op:'='}" class="span12" />
							<label>Участие</label>
							<select ng-model="requestParams.mode" class="span12">
								<option value="All">Все</option>
								<option value="Participated">Я участник</option>
							</select>
							<label>Теги</label>
							<input lookup="home/dictionary/lookupProjectTags" ng-model="filter.simple.Tags" filter-node="{path: 'Tags.Tag', op:'='}" class="span12" multiple />
						</fieldset>
					</form>
				</tab>
				<tab heading="Complex">
					<div structured-filter filter-ng-model="filter.complex" meta="'home/projects/projectMetadata'">
					</div>
				</tab>

				<tab heading="Favorites">
					<div filter-persister group="'Projects'" filter="filter"></div>
				</tab>

			</tabset>
		</twocolumn-side>


		<twocolumn-content>
			<div style="margin-bottom: 10px;" ng-show="currentUser.admin">
				<a class="btn btn-primary" href="#!/projects/create">
					<i class="icon-plus icon-white"></i>
					<span>Добавить проект</span>
				</a>
			</div>

			<table class="table table-bordered"
			       infinite-scroll="paging.page = paging.page + 1"
			       infinite-scroll-disabled="applyEnabled"
			       infinite-scroll-distance="1">
				<thead>
					<tr>
						<th><span sortable-heading="sorters.Name" caption="Наименование"></span></th>
						<th><span sortable-heading="sorters.Type_Name" caption="Тип"></span></th>
						<th><span sortable-heading="sorters.Description" caption="Описание"></span></th>
						<th><span sortable-heading="sorters.Status_Name" caption="Статус"></span></th>
						<th><span sortable-heading="sorters.CreationTime" caption="Дата создания"></span></th>
						<th><span sortable-heading="sorters.IsArchive" caption="Архив"></span></th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="model in models">
						<td>
							<a href="/projects/{{model.ProjectCode}}" target="_blank">
								{{ model.Name }}
							</a>&nbsp;(
							<a href="#!/projects/projectDetails/{{ model.Id }}">
								details
							</a>)
						</td>
						<td>{{ model.Type.Name }}</td>
						<td>{{ model.Description }}</td>
						<td>{{ model.Status.Name }}</td>
						<td>{{ model.CreationTime | date:'dd.MM.yyyy hh:mm:ss' }}</td>
						<td>{{ model.IsArchive | yesNo }}</td>
					</tr>
				</tbody>
			</table>

			<div ng-show="indication.loading" us-spinner="{top:100}"></div>
			<button type="button" class="btn btn-primary" ng-click="paging.page = paging.page + 1"
				ng-disabled="applyEnabled">More</button>
		</twocolumn-content>
	</div>
</container>