<div class="container-fluid" ng-controller="taskListCtrl"
        filtered-list="{method: 'tasks/tasks/getTasks'}"
        initial-sorters="{ InternalSeqNumber: 'desc' }">
	<div class="row-fluid">
<!-- data-offset-top="50" -->
		<div class="span3">
			<div filtered-list-actions></div>

			<tabset>
				<tab heading="{{ 'core.filters.simple' | i18n }}">
					<form>
						<fieldset>
							<label>{{ 'tasks.list.filters.custom' | i18n }}</label>
							<select ng-model="customFilter.selected" ng-options="f.text for f in customFilter.predefined" ng-change="constructCombinedFilter()" class="span12" >
							</select>
							<label>{{ 'tasks.fields.status' | i18n }}</label>
							<input lookup="tasks/dictionary/lookupTaskStatuses" ng-model="filter.simple.Status" filter-node="{path: 'Status', op: '='}" class="span12" multiple />
							<label>{{ 'tasks.fields.customStatus' | i18n }}</label>
							<input lookup="tasks/dictionary/lookupCustomStatuses" ng-model="filter.simple.CustomStatus" filter-node="{path: 'CustomStatus', op: '='}" class="span12" multiple />
							<label>{{ 'tasks.fields.seqNumber' | i18n }}</label>
							<input lookup="tasks/tasks/lookupTasks" ng-model="filter.simple.SeqNumber" filter-node="{path: 'Id', op: '='}" class="span12" multiple />
							<label>{{ 'tasks.fields.type' | i18n }}</label>
							<input lookup="tasks/dictionary/lookupTaskTypes" ng-model="filter.simple.TaskType" filter-node="{path: 'TaskType', op: '='}" class="span12" multiple />
							<label>{{ 'tasks.fields.dueDate' | i18n }}</label>
							<input type="text" ng-model="customFilter.lDate" ui-date="{dateFormat: 'dd.mm.yy', changeMonth: true, changeYear: true}" ng-change="constructDueDateFilter()" class="span5" />
								- <input type="text" ng-model="customFilter.rDate" ui-date="{dateFormat: 'dd.mm.yy', changeMonth: true, changeYear: true}" ng-change="constructDueDateFilter()" class="span5" />
							<label>{{ 'tasks.fields.executors' | i18n }}</label>
							<input lookup="home/projects/lookupParticipant" ng-model="filter.simple.Executors" filter-node="{path: 'Executors.Id', op: '='}" class="span12" multiple />
							<label>{{ 'tasks.fields.content' | i18n }}</label>
							<input type="text" ng-model="filter.simple.Content" filter-node="{path: 'Content', op:'like'}" class="span12"  />
						</fieldset>
					</form>
				</tab>

				<tab heading="{{ 'core.filters.user' | i18n }}">
					<div user-filter filter-ng-model="filter.user"></div>
				</tab>

				<tab heading="{{ 'core.filters.complex' | i18n }}">
					<div structured-filter filter-ng-model="filter.complex" meta="'tasks/tasks/taskMetadata'">
					</div>
				</tab>

				<tab heading="{{ 'core.filters.favorites' | i18n }}">
					<div filter-persister group="'Tasks.Task'" filter="filter"></div>
				</tab>
			</tabset>
		</div><!-- sidebar -->

		<div class="span9">
			<div class="alert alert-error span12" ng-show="validation.generalErrors">
				{{ validation.generalErrors }}
			</div>

			<div>
				<a href="#!/tasks/new" style="margin-bottom: 20px;" class="btn btn-primary" ng-click="newItem();">
					<i class="icon-plus icon-white"></i>
					<span>{{ 'tasks.list.buttons.add' | i18n }}</span>
				</a>
				<button type="button" class="btn pull-right" ng-click="deleteSelected()" ng-disabled="!hasSelected()" title="{{ 'tasks.list.placeholders.deleteSelected' | i18n }}">
					{{ 'core.buttons.delete' | i18n }}
				</button>
			</div>

			<table class="table table-bordered"
					infinite-scroll="paging.page = paging.page + 1"
					infinite-scroll-disabled="applyEnabled"
					infinite-scroll-distance="1">
				<thead>
					<tr>
						<th class="onepct">
							<input type="checkbox" checker="items: 'models'">
						</th>
						<th><span sortable-heading="sorters.InternalSeqNumber" caption="{{ 'tasks.fields.seqNumber' | i18n }}"></span></th>
						<th><span sortable-heading="sorters.TaskType_Name" caption="{{ 'tasks.fields.type' | i18n }}"></span></th>
						<th style="width: 20%">{{ 'tasks.fields.executors' | i18n }}</th>
						<th><span sortable-heading="sorters.DueDate" caption="{{ 'tasks.fields.dueDate' | i18n }}"></span></th>
						<th><span sortable-heading="sorters.Status" caption="{{ 'tasks.fields.status' | i18n }}"></span></th>
						<th><span sortable-heading="sorters.CustomStatus_Name" caption="{{ 'tasks.fields.customStatus' | i18n }}"></span></th>
						<th class="onepct">&nbsp;</th>
					</tr>
				</thead>
				<!-- TODO waiting for new angular version
				http://stackoverflow.com/questions/16900050/angular-js-ng-repeat-across-multiple-elements -->
				<tbody ng-repeat="model in models">
					<tr ng-click="toggleDetails(model)">
						<td>
							<input type="checkbox" ng-model="model.selected" data-itemid="{{ model.Id }}">
						</td>
						<td>
							<a href="#!/tasks/{{model.SeqNumber}}" style="white-space: nowrap">
								{{ model.SeqNumber }}
							</a>
						</td>
						<td>
							{{ model.TaskType }}
							<p ng-show="model.Content" title="{{ model.Content }}">
								<small class="clip-content">{{ model.Content | textCut:50 }}</small>
							</p>
						</td>
						<td>
							<executors model="model.Executors" ></executors>
						</td>
						<td>{{ model.DueDate | date:'dd.MM.yyyy' }}</td>
						<td>{{ model.Status }}</td>
						<td>{{ model.CustomStatus }}</td>
						<td>
							<button type="button" class="close" title="{{ 'tasks.list.placeholders.delete' | i18n }}" ng-click="delete(model)">&times;</button>
						</td>
					</tr>
					<tr ng-show="model.details.expanded" ng-init="model.details.loaded = false">
						<td colspan="8">
							<div ng-hide="model.details.loaded">{{ 'core.labels.loading' | i18n }}...</div>
							<div ng-show="model.details.loaded">
								<table class="table table-bordered">
									<tr>
										<td>{{ 'tasks.fields.priority' | i18n }}</td>
										<td>{{ model.details.Priority }}</td>
									</tr>
									<tr>
										<td>{{ 'tasks.fields.content' | i18n }}</td>
										<td>
											<pre>{{ model.details.Content }}</pre>
										</td>
									</tr>
									<tr>
										<td>{{ 'tasks.fields.note' | i18n }}</td>
										<td>{{ model.details.Note }}</td>
									</tr>
									<tr>
										<td>{{ 'tasks.fields.agreements' | i18n }}</td>
										<td>
											<span ng-repeat="a in model.details.Agreements">
												<i ng-class="{'icon-check': a.Done, 'icon-check-empty': !a.Done}"></i>{{ a.Agreemer }}
											</span>&nbsp; &nbsp;
										</td>
									</tr>
									<tr>
										<td>{{ 'tasks.fields.topFiles' | i18n:{ count: 5 } }}</td>
										<td>
											<a href="/services/download/file/{{f}}" target="_blank" ng-repeat="f in model.details.Files">
												<i class="icon-paper-clip"></i>{{ f }}
											</a>
										</td>
									</tr>
								</table>
							</div>
						</td>
					</tr>
				</tbody>
			</table>

			<div ng-show="indication.loading" us-spinner="{top:100}"></div>
			<button type="button" class="btn btn-primary" ng-click="paging.page = paging.page + 1"
			        ng-disabled="applyEnabled">{{ 'core.buttons.more' | i18n }}</button>
		</div><!-- content -->

	</div><!-- row -->
</div><!-- container -->