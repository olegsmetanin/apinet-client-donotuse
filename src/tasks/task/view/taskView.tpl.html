<div class="container-fluid" ng-controller="taskViewCtrl">
	<div class="row-fluid">
		<div class="span12">
			<task-tabs current-tab="overview" task-num="model.SeqNumber" />
		</div>
	</div>
	<div class="row-fluid">
		<div class="span3">
			<div id="sideBarMenu" class="well" affix scrollspy="#sideBarMenu">
				<ul class="nav nav-list">
					<li>
						<a href="#general">
							Общие&nbsp;свойства
						</a>
					</li>
					<li>
						<a href="#agreements">
							Согласования
						</a>
					</li>
					<li>
						<a href="#statusHistory">
							История&nbsp;статуса
						</a>
					</li>
					<li>
						<a href="#customStatusHistory">
							История&nbsp;пользовательского статуса
						</a>
					</li>
					<li>
						<a href="#params">
							Пользовательские&nbsp;свойства
						</a>
					</li>
				</ul>
			</div>
		</div>
		<div class="span9">
			<div class="alert alert-error span12" ng-show="validation.generalErrors">
				{{ validation.generalErrors }}
			</div>

			<section id="general">
				<h3>Общие свойства</h3>
				<table class="table">
					<tr>
						<td class="span3">Номер п/п</td>
						<td>{{ model.SeqNumber }}</td>
					</tr>
					<tr>
						<td>Тип</td>
						<td>
							<inline-lookup model="model.TaskType" on-update="onUpdateProp(model, 'TaskType', val)" input-lookup="tasks/dictionary/lookupTaskTypes" input-class="span10" required />
						</td>
					</tr>
					<tr>
						<td>Исполнители</td>
						<td>
							<inline-lookup model="model.Executors" on-update="onUpdateProp(model, 'Executors', val)" input-lookup="home/projects/lookupParticipant" input-class="span10" multiple required>
								<executors model="model.Executors" />
							</inline-lookup>
							
						</td>
					</tr>
					<tr>
						<td>Содержание</td>
						<td>
							<inline-text-area model="model.Content" on-update="onUpdateProp(model, 'Content', val)" pre-class="span10" input-class="span10" input-rows="3" />
						</td>
					</tr>
					<tr>
						<td>Срок</td>
						<td>
							<inline-date model="model.DueDate" on-update="onUpdateProp(model, 'DueDate', val)" date-format="dd.MM.yyyy" />
						</td>
					</tr>
					<tr>
						<td>Статус</td>
						<td>
							<inline-lookup model="model.Status" on-update="onUpdateProp(model, 'Status', val)" input-lookup="tasks/dictionary/lookupTaskStatuses" input-class="span10" required />
						</td>
					</tr>
					<tr>
						<td>Пользовательский статус</td>
						<td>
							<inline-lookup model="model.CustomStatus" on-update="onUpdateProp(model, 'CustomStatus', val)" input-lookup="tasks/dictionary/lookupCustomStatuses" input-class="span10" />
						</td>
					</tr>
					<tr>
						<td>Приоритет</td>
						<td>
							<inline-lookup model="model.Priority" on-update="onUpdateProp(model, 'Priority', val)" input-lookup="tasks/dictionary/lookupTaskPriorities" input-class="span10" required />
						</td>
					</tr>
					<tr>
						<td>Автор</td>
						<td>{{ model.Author }}</td>
					</tr>
					<tr>
						<td>Создано</td>
						<td>{{ model.CreationTiime }}</td>
					</tr>
				</table>
			</section>
			<section id="agreements">
				<h3>Согласования</h3>
				<table class="table table-bordered">
					<thead>
						<tr>
							<th>Согласующий</th>
							<th>Срок</th>
							<th class="onepct">Согласовано</th>
							<th class="span3">Дата</th>
							<th class="span4">Комментарий</th>
							<th class="onepct">&nbsp;</th>
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="a in model.Agreements">
							<td>{{ a.Agreemer }}</td>
							<td>{{ a.DueDate | date:'dd.MM.yyyy' }}</td>
							<td>
								<i ng-class="{'icon-check': a.Done, 'icon-check-empty': !a.Done}"></i>
							</td>
							<td>{{ a.AgreedAt | date:'dd.MM.yyyy hh:mm' }}</td>
							<td>{{ a.Comment }}</td>
							<td>
								<button type="button" class="close" title="Удалить согласущего" ng-click="removeAgreement(a)" ng-show="isAgreementsEditable()">&times;</button>
							</td>
						</tr>
					</tbody>
					<tfoot ng-show="isAgreementsEditable()">
						<tr ng-show="editables.addState">
							<td colspan="6" class="form-inline">
								<input type="text" name="agreemer" lookup="home/projects/lookupParticipant" ng-model="editables.newAgreemer" placeholder="Выберите согласущего" class="span4" />
								<input type="text" ng-model="editables.dueDate" ui-date="{dateFormat:'dd.mm.yy', changeMonth: true, changeYear: true}" span="3" placeholde="Срок" />
								<button type="button" class="btn" ng-click="addAgreemer()" ng-disabled="!addAgreementAvailable()">Добавить</button>

								<div class="btn-group">
									<a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
										Согласование
										<span class="caret"></span>
									</a>
									<ul class="dropdown-menu">
										<li><a ng-click="agree()">Согласовать</a></li>
										<li><a ng-click="toggleAgree()">Согласовать с комментарием</a></li>
										<li class="divider"></li>
										<li><a ng-click="revoke()">Отозвать согласование</a></li>
									</ul>
								</div>
							</td>
						</tr>
						<tr ng-hide="editables.addState">
							<td colspan="6">
								<div class="input-append span12">
									<input type="text" ng-model="editables.comment" class="span6" placeholder="Комментарий к согласованию">
									<button type="button" class="btn" ng-click="toggleAgree()" title="Отменить">
										<i class="icon-reply"></i>
									</button>
									<button type="button" class="btn" ng-click="agree()" title="Согласовать">
										<i class="icon-ok"></i>
									</button>
								</div>
							</td>
						</tr>
					</tfoot>
				</table>
			</section>
			<section id="statusHistory">
				<h3>История изменения статуса</h3>
				<status-history model="model.StatusHistory" change="changeStatus" />
			</section>
			<section id="customStatusHistory">
				<h3>История изменения пользовательского статуса</h3>
				<status-history model="model.CustomStatusHistory" change="changeCustomStatus" />
			</section>
			<section id="params">
				<h3>Пользовательские свойства</h3>
				<custom-properties model="model.Parameters" />
			</section>
		</div>
	</div>
</div>